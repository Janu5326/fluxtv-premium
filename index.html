<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FluxTV Premium — Embedded M3U (Sample)</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.5/dist/hls.min.js"></script>

<style>
  :root{
    --bg:#0b1220; --card:#0f1724; --muted:#9fb0d6; --text:#e6eef8;
    --accent:#10b981; --accent-2:#06b6d4;
    --radius:12px; --nav-h:72px;
    font-family:'Inter',system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  }
  body{margin:0;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:12px}
  .app{width:100%;max-width:980px}
  header{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:12px;background:rgba(255,255,255,0.02);box-shadow:0 8px 20px rgba(0,0,0,0.6)}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:grid;place-items:center;font-weight:700}
  .small{font-size:13px;color:var(--muted)}
  /* player */
  .player-wrap{border-radius:12px;overflow:hidden;background:#000;margin-top:12px;box-shadow:0 18px 40px rgba(0,0,0,0.6)}
  video#player{width:100%;height:220px;background:#000;display:block}
  .controls{display:flex;justify-content:space-between;align-items:center;padding:8px;background:rgba(255,255,255,0.02)}
  .btn{background:var(--accent);border:0;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04)}
  /* grid circular icons */
  .tabs{display:flex;gap:8px;margin-top:12px}
  .tab{padding:10px 12px;border-radius:10px;background:rgba(255,255,255,0.02);cursor:pointer}
  .tab.active{box-shadow:inset 0 -4px 0 rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.02)}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(86px,1fr));gap:12px;margin-top:12px}
  .channel{background:transparent;border-radius:10px;padding:6px;display:flex;flex-direction:column;align-items:center;gap:6px;text-align:center;cursor:pointer}
  .avatar{width:80px;height:80px;border-radius:50%;background:#08121a;display:flex;align-items:center;justify-content:center;border:3px solid rgba(16,185,129,0.2);overflow:hidden}
  .avatar img{width:100%;height:100%;object-fit:cover}
  .ch-title{font-size:13px;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:86px}
  /* bottom nav */
  nav{position:fixed;left:50%;transform:translateX(-50%);bottom:14px;background:rgba(15,21,30,0.9);width:calc(100% - 32px);max-width:980px;height:60px;border-radius:14px;display:flex;align-items:center;justify-content:space-around;box-shadow:0 18px 40px rgba(0,0,0,0.6)}
  .nav-item{display:flex;flex-direction:column;align-items:center;font-size:12px;color:var(--muted)}
  .nav-item.active{color:var(--accent)}
  /* responsive */
  @media (max-width:480px){ video#player{height:180px} .grid{grid-template-columns:repeat(auto-fill,minmax(80px,1fr))} .ch-title{width:72px}}
  .warn{background:#7a2b2b;padding:8px;border-radius:8px;color:#fff;margin-top:8px}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="brand">
      <div class="logo">Fx</div>
      <div>
        <div style="font-weight:700">FluxTV Premium</div>
        <div class="small">Live TV — embedded sample channels</div>
      </div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <button class="btn ghost" id="openImport">Import .m3u</button>
      <button class="btn" id="openSettings">Settings</button>
    </div>
  </header>

  <!-- Player -->
  <div id="playerArea" class="player-wrap" style="margin-top:12px">
    <video id="player" controls playsinline crossorigin="anonymous"></video>
    <div class="controls">
      <div>
        <strong id="playerTitle">—</strong><div id="playerInfo" class="small">—</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <select id="qualitySelect" style="padding:6px;border-radius:8px;background:transparent;color:var(--text)"></select>
        <button class="btn" id="closePlayer">Close</button>
      </div>
    </div>
    <div id="playerWarn" class="warn" style="display:none">Stream may be blocked by browser (HTTP/CORS)</div>
  </div>

  <!-- tabs -->
  <div class="tabs">
    <div class="tab active" data-tab="live">Live Events</div>
    <div class="tab" data-tab="sports">Sports</div>
    <div class="tab" data-tab="cats">Categories</div>
  </div>

  <!-- grid -->
  <div id="gridContainer">
    <div id="grid" class="grid"></div>
  </div>
</div>

<nav>
  <div class="nav-item active"><i class="fa fa-broadcast-tower"></i><div>Live</div></div>
  <div class="nav-item"><i class="fa fa-baseball"></i><div>Sports</div></div>
  <div class="nav-item"><i class="fa fa-tv"></i><div>Categories</div></div>
</nav>

<!-- import modal -->
<div id="overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:60;align-items:center;justify-content:center">
  <div style="background:var(--card);padding:16px;border-radius:12px;width:calc(100% - 40px);max-width:720px">
    <h3>Import M3U Playlist</h3>
    <p class="small">Choose .m3u/.m3u8 file or paste contents. Remote streams need HTTPS + CORS to play in browser.</p>
    <div style="display:flex;gap:8px;align-items:center">
      <input id="fileInput" type="file" accept=".m3u,.m3u8,text/plain" />
      <button class="btn" id="doLoad">Load</button>
    </div>
    <label style="margin-top:8px">Or paste M3U</label>
    <textarea id="m3uText" rows="8" style="width:100%;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);color:var(--text)"></textarea>
    <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
      <button class="btn" id="importBtn">Import</button>
      <button class="btn ghost" id="cancelImport">Cancel</button>
    </div>
  </div>
</div>

<script>
/* ====== embedded channels sample (first 200 from your M3U) =====
   structure: { title, category, logo, url }
   NOTE: many urls may be http or localhost; browser playback may be blocked.
*/
const channelsData = [
  /* EMBEDDED SAMPLE START */
  <!-- CHANNELS_JSON_PLACEHOLDER -->
  /* EMBEDDED SAMPLE END */
];

/* state */
const state = { channels: channelsData.slice(), current:null, favorites:new Set(JSON.parse(localStorage.getItem('flux_favs')||'[]')), hls:null };

/* dom refs */
const grid = document.getElementById('grid');
const player = document.getElementById('player');
const playerTitle = document.getElementById('playerTitle');
const playerInfo = document.getElementById('playerInfo');
const qualitySelect = document.getElementById('qualitySelect');
const playerWarn = document.getElementById('playerWarn');
const overlay = document.getElementById('overlay');
const fileInput = document.getElementById('fileInput');
const m3uText = document.getElementById('m3uText');

/* render grid */
function renderGrid(){
  grid.innerHTML = '';
  state.channels.forEach((ch, idx)=>{
    const div = document.createElement('div'); div.className='channel';
    div.innerHTML = `<div class="avatar" title="${escapeHtml(ch.title)}">${ch.logo ? `<img src="${ch.logo}" onerror="this.style.display='none'">` : `<div style="font-size:20px;color:var(--muted)">${escapeHtml(ch.title.slice(0,2))}</div>`}</div><div class="ch-title">${escapeHtml(ch.title)}</div>`;
    div.addEventListener('click', ()=> onChannelClick(idx));
    grid.appendChild(div);
  });
}

/* channel click */
function onChannelClick(index){
  const ch = state.channels[index];
  if(!ch) return;
  state.current = ch;
  playerTitle.textContent = ch.title;
  playerInfo.textContent = (ch.category||'—');
  // populate qualitySelect (we only have Auto)
  qualitySelect.innerHTML = `<option>Auto</option>`;
  // show warn if http on https page
  if(ch.url && ch.url.startsWith('http://') && location.protocol === 'https:') {
    playerWarn.style.display = 'block';
    playerWarn.textContent = 'Warning: This stream uses HTTP and may be blocked by the browser (mixed content).';
  } else { playerWarn.style.display = 'none'; }
  loadStream(ch.url);
  // bring player into view
  window.scrollTo({top:0,behavior:'smooth'});
}

/* load stream via HLS.js */
async function loadStream(url){
  try{ if(state.hls){ state.hls.destroy(); state.hls = null; } }catch(e){}
  player.pause(); player.removeAttribute('src'); player.load();
  if(!url){ alert('No url'); return; }
  // if hls supported
  if(Hls.isSupported()){
    const hls = new Hls();
    state.hls = hls;
    try{
      hls.loadSource(url);
      hls.attachMedia(player);
      hls.on(Hls.Events.MANIFEST_PARSED, ()=>{ player.play().catch(()=>{}); });
      hls.on(Hls.Events.ERROR, (evt,data)=>{ console.warn('HLS error',data); });
    }catch(err){
      console.warn('HLS load error',err);
      player.src = url; // fallback
    }
  } else {
    player.src = url;
    player.play().catch(()=>{});
  }
}

/* helpers */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, (m)=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

/* import UI */
document.getElementById('openImport').addEventListener('click', ()=> overlay.style.display='flex');
document.getElementById('cancelImport').addEventListener('click', ()=> { overlay.style.display='none'; m3uText.value=''; });
document.getElementById('doLoad').addEventListener('click', ()=>{
  const f = fileInput.files[0];
  if(!f) return alert('Select a file');
  const fr = new FileReader();
  fr.onload = ()=> {
    m3uText.value = fr.result;
    alert('File loaded to textarea — click Import to parse.');
  }
  fr.readAsText(f);
});
document.getElementById('importBtn').addEventListener('click', ()=>{
  const txt = m3uText.value.trim();
  if(!txt) return alert('Paste or load a M3U file first.');
  const parsed = parseM3U(txt);
  if(parsed.length===0) return alert('No channels parsed.');
  // prepend parsed channels
  state.channels = parsed.concat(state.channels);
  localStorage.setItem('flux_channels', JSON.stringify(state.channels));
  overlay.style.display='none';
  m3uText.value='';
  renderGrid();
  alert('Imported ' + parsed.length + ' channels. Note: browser may block some streams (HTTP/CORS).');
});

/* M3U parse (simple) */
function parseM3U(text){
  const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
  const entries = []; let lastInfo=null;
  for(let i=0;i<lines.length;i++){
    const line = lines[i];
    if(line.startsWith('#EXTINF:')) lastInfo=line;
    else if(line.startsWith('#')) {}
    else if(/^https?:\/\//i.test(line)){
      let title = lastInfo ? (lastInfo.split(',')[1]||lastInfo) : line;
      title = title.replace(/["']/g,'').trim();
      const m = lastInfo ? lastInfo.match(/group-title="([^"]+)"/) : null;
      const group = m ? m[1] : '';
      const m2 = lastInfo ? lastInfo.match(/tvg-logo="([^"]+)"/) : null;
      const logo = m2 ? m2[1] : '';
      entries.push({ title, category:group, logo, url:line });
      lastInfo=null;
    } else {
      lastInfo=null;
    }
  }
  return entries;
}

/* initial render */
renderGrid();

/* settings button - minimal */
document.getElementById('openSettings').addEventListener('click', ()=> alert('Settings: theme and playback options can be added.'));

</script>
</body>
</html>
